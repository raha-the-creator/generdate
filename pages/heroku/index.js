import React from "react";
import Head from "next/head";
import ActivityCard from "../../comps/ActivityCard";
import { useState } from "react";

export async function getServerSideProps({}) {
  const data = await fetch("https://generdate-api.herokuapp.com/activities");
  const activities = await data.json();

  return {
    props: {
      activities,
    },
  };
}

export default function Heroku({ activities }) {
  const [query, setQuery] = useState("");

  //Function for multiple search filter
  const search = (array) => {
    return array.filter((el) =>
      Object.keys(el).some((name, location) =>
        el[name].toString().toLowerCase().includes(query) || el[location]?.toString().toLowerCase().includes(query)
      )
    );
  };


  //Applying our search filter function to our array of countries recieved from the API
  const filtered = search(activities);

  // set the value of our useState query anytime the user types on our input
  const handleChange = (e) => {
    setQuery(e.target.value);
  };

  console.log(filtered);

  return (
    <>
      <Head>
        <title>Activities search</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/logo.svg" />
      </Head>

      <main class="flex flex-col w-full h-full text-center justify-center items-center">
        <div class="flex flex-col px-12 bg-white rounded-lg w-11/12 justify-start items-center my-6 ">
          <div>
            <h2 class="text-left text-3xl font-roboto-mono font-bold my-4">
              Activities to explore
            </h2>

            <div className="w-11/12 m-4 bg-red flex flex-col md:flex-row justify-between items-start md:items-center gap-5 md:gap-0">
              <input
                onChange={handleChange}
                type="text"
                placeholder="Type your activity"
                className="w-full inline-block rounded box-border border-solid border-2 border-gray-400 p-2"
              />
            </div>

            <div class="flex flex-row flex-wrap w-full -mx-4">
              {filtered.map((activity, index) => {
                return (
                  <ActivityCard
                    key={activity.id}
                    link={`activities/${index + 2}`}
                    img={activity.feature}
                    header={activity.name}
                    price={activity.price}
                    city={activity.location}
                    tags={activity.tags}
                  />
                );
              })}
            </div>
          </div>
        </div>
      </main>
    </>
  );
}
